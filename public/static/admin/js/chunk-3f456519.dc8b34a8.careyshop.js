(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3f456519","chunk-9b341698"],{"498a":function(t,e,a){"use strict";var o=a("23e7"),r=a("58a8").trim,i=a("c8d2");o({target:"String",proto:!0,forced:i("trim")},{trim:function(){return r(this)}})},"5d2c":function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"cs-p"},[a("el-form",{attrs:{inline:!0,size:"small"}},[t.auth.add?a("el-form-item",[a("el-button",{attrs:{icon:"el-icon-plus",disabled:t.loading},on:{click:function(e){return t.handleCreate(null)}}},[t._v("新增主属性")])],1):t._e(),t.auth.search?a("el-form-item",[a("el-button-group",[a("el-button",{attrs:{icon:"el-icon-remove-outline",disabled:t.loading},on:{click:function(e){return t.handleIndex(0)}}},[t._v("不检索")]),a("el-button",{attrs:{icon:"el-icon-collection-tag",disabled:t.loading},on:{click:function(e){return t.handleIndex(1)}}},[t._v("关键词")]),a("el-button",{attrs:{icon:"el-icon-refresh-left",disabled:t.loading},on:{click:function(e){return t.handleIndex(2)}}},[t._v("范围")])],1)],1):t._e(),t.auth.del?a("el-form-item",[a("el-button",{attrs:{icon:"el-icon-delete",disabled:t.loading},on:{click:function(e){return t.handleDelete(null)}}},[t._v("删除")])],1):t._e(),a("cs-help",{staticStyle:{"padding-bottom":"19px"},attrs:{router:t.$route.path}})],1),a("el-table",{ref:"multipleTable",attrs:{data:t.currentTableData,"highlight-current-row":!0,"row-key":"goods_attribute_id","tree-props":{children:"get_attribute"}},on:{"selection-change":t.handleSelectionChange,"sort-change":t.sortChange}},[a("el-table-column",{attrs:{align:"center",type:"selection",width:"55"}}),a("el-table-column",{attrs:{label:"编号",prop:"goods_attribute_id",sortable:"custom",width:"120"}}),a("el-table-column",{attrs:{width:"60"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.icon?a("el-popover",{attrs:{width:"150",placement:"top",trigger:"hover"}},[a("div",{staticClass:"popover-image"},[a("el-image",{attrs:{src:t._f("getPreviewUrl")(e.row.icon),fit:"fill"},on:{click:function(a){return a.stopPropagation(),t.$preview(e.row.icon)}}})],1),a("i",{staticClass:"el-icon-picture cs-mr-5",attrs:{slot:"reference"},slot:"reference"})]):t._e(),e.row.is_important?a("i",{staticClass:"attribute-important el-icon-s-flag"}):t._e()]}}])}),a("el-table-column",{attrs:{label:"名称",prop:"attr_name",sortable:"custom","min-width":"140"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.description?a("el-tooltip",{attrs:{content:"描述："+e.row.description,placement:"top"}},[a("span",[t._v(" "+t._s(e.row.attr_name)+" ")])]):a("span",[t._v(" "+t._s(e.row.attr_name)+" ")])]}}])}),a("el-table-column",{attrs:{label:"所属模型",prop:"goods_type_id",sortable:"custom","show-overflow-tooltip":!0,"min-width":"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.parent_id?t._e():a("span",[t._v(t._s(t.typeData[e.row.goods_type_id]))])]}}])}),a("el-table-column",{attrs:{label:"检索方式",width:"90"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.indexMap[e.row.attr_index])+" ")]}}])}),a("el-table-column",{attrs:{label:"录入方式",width:"90"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.inputMap[e.row.attr_input_type])+" ")]}}])}),a("el-table-column",{attrs:{label:"可选值","show-overflow-tooltip":!0,"min-width":"160"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t._f("getAttrValue")(e.row.attr_values))+" ")]}}])}),a("el-table-column",{attrs:{label:"排序值",prop:"sort",sortable:"custom",align:"center","min-width":"110"},scopedSlots:t._u([{key:"default",fn:function(e){return[t.auth.sort?a("el-input-number",{staticStyle:{width:"88px"},attrs:{size:"mini","controls-position":"right",min:0,max:255},on:{change:function(a){return t.handleSort(e.row)}},model:{value:e.row.sort,callback:function(a){t.$set(e.row,"sort",a)},expression:"scope.row.sort"}}):a("span",[t._v(" "+t._s(e.row.sort)+" ")])]}}])}),a("el-table-column",{attrs:{label:"操作",align:"center","min-width":"160"},scopedSlots:t._u([{key:"default",fn:function(e){return[!e.row.parent_id&&t.auth.add_son?a("el-button",{attrs:{size:"small",type:"text"},on:{click:function(a){return t.handleCreate(e.row)}}},[t._v("新增子属性")]):t._e(),e.row.parent_id&&t.auth.important?a("el-button",{attrs:{size:"small",type:"text"},on:{click:function(a){return t.handleImportant(e.row)}}},[t._v(t._s(t.importantMap[e.row.is_important]))]):t._e(),t.auth.set?a("el-button",{attrs:{size:"small",type:"text"},on:{click:function(a){return t.handleUpdate(e.row)}}},[t._v("编辑")]):t._e(),t.auth.del?a("el-button",{attrs:{size:"small",type:"text"},on:{click:function(a){return t.handleDelete(e.row.goods_attribute_id)}}},[t._v("删除")]):t._e()]}}])})],1),a("el-dialog",{attrs:{title:t.textMap[t.dialogStatus],visible:t.dialogFormVisible,"append-to-body":!0,"close-on-click-modal":!1,width:"600px"},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[a("el-form",{ref:"form",attrs:{model:t.form,rules:t.rules,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"名称",prop:"attr_name"}},[a("el-input",{attrs:{placeholder:"请输入商品属性名称",clearable:!0},model:{value:t.form.attr_name,callback:function(e){t.$set(t.form,"attr_name",e)},expression:"form.attr_name"}})],1),a("el-form-item",{attrs:{label:"描述",prop:"description"}},[a("el-input",{attrs:{placeholder:"可输入商品属性描述",type:"textarea",rows:3},model:{value:t.form.description,callback:function(e){t.$set(t.form,"description",e)},expression:"form.description"}})],1),t.form.parent_id?t._e():a("el-form-item",{attrs:{label:"所属模型",prop:"goods_type_id"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择所属商品模型",clearable:""},model:{value:t.form.goods_type_id,callback:function(e){t.$set(t.form,"goods_type_id",e)},expression:"form.goods_type_id"}},t._l(t.typeData,(function(t,e){return a("el-option",{key:e,attrs:{label:t,value:e}})})),1)],1),a("el-form-item",{attrs:{label:"图标",prop:"icon"}},[a("el-input",{attrs:{placeholder:"可输入商品属性图标(图片)",clearable:!0},model:{value:t.form.icon,callback:function(e){t.$set(t.form,"icon",e)},expression:"form.icon"}},[a("template",{slot:"prepend"},[t.form.icon?a("el-popover",{attrs:{width:"150",placement:"top",trigger:"hover"}},[a("div",{staticClass:"popover-image"},[a("el-image",{attrs:{src:t._f("getPreviewUrl")(t.form.icon),fit:"fill"},on:{click:function(e){return e.stopPropagation(),t.$preview(t.form.icon)}}})],1),a("i",{staticClass:"el-icon-picture",attrs:{slot:"reference"},slot:"reference"})]):t._e()],1),a("el-dropdown",{attrs:{slot:"append","show-timeout":50},on:{command:t.handleCommand},slot:"append"},[a("el-button",{attrs:{icon:"el-icon-upload"}}),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{attrs:{command:"storage",icon:"el-icon-finished"}},[t._v("资源选择")]),a("el-dropdown-item",{attrs:{command:"upload",icon:"el-icon-upload2"}},[t._v("上传资源")])],1)],1)],2)],1),t.form.parent_id?a("div",[a("el-form-item",{attrs:{label:"检索方式",prop:"attr_index"}},[a("el-radio-group",{model:{value:t.form.attr_index,callback:function(e){t.$set(t.form,"attr_index",e)},expression:"form.attr_index"}},t._l(t.indexMap,(function(e,o){return a("el-radio",{key:o,attrs:{label:o,disabled:"0"===t.form.attr_input_type}},[t._v(t._s(e))])})),1)],1),a("el-form-item",{attrs:{label:"录入方式",prop:"attr_input_type"}},[a("el-radio-group",{on:{change:t.changeAttrValue},model:{value:t.form.attr_input_type,callback:function(e){t.$set(t.form,"attr_input_type",e)},expression:"form.attr_input_type"}},t._l(t.inputMap,(function(e,o){return a("el-radio",{key:o,attrs:{label:o}},[t._v(t._s(e))])})),1)],1),a("el-form-item",{attrs:{label:"可选值",prop:"attr_values"}},[a("el-input",{attrs:{placeholder:"请输入商品属性可选值，一行一个，手工填写可不填",type:"textarea",rows:5},model:{value:t.form.attr_values,callback:function(e){t.$set(t.form,"attr_values",e)},expression:"form.attr_values"}})],1)],1):t._e(),a("el-form-item",{attrs:{label:"排序值",prop:"sort"}},[a("el-input-number",{staticStyle:{width:"120px"},attrs:{"controls-position":"right",min:0,max:255},model:{value:t.form.sort,callback:function(e){t.$set(t.form,"sort",e)},expression:"form.sort"}})],1),t.form.parent_id?a("el-form-item",{attrs:{label:"是否核心",prop:"is_important"}},[a("el-switch",{attrs:{"active-value":1,"inactive-value":0},model:{value:t.form.is_important,callback:function(e){t.$set(t.form,"is_important",e)},expression:"form.is_important"}})],1):t._e()],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:function(e){t.dialogFormVisible=!1}}},[t._v("取消")]),"create"===t.dialogStatus||"sonCreate"===t.dialogStatus?a("el-button",{attrs:{type:"primary",loading:t.dialogLoading,size:"small"},on:{click:t.create}},[t._v("确定")]):a("el-button",{attrs:{type:"primary",loading:t.dialogLoading,size:"small"},on:{click:t.update}},[t._v("修改")])],1),a("cs-storage",{ref:"storage",staticStyle:{display:"none"},attrs:{limit:1},on:{confirm:t._getStorageFileList}}),a("cs-upload",{ref:"upload",staticStyle:{display:"none"},attrs:{type:"slot",accept:"image/*",limit:1,multiple:!1},on:{confirm:t._getUploadFileList}})],1)],1)},r=[],i=(a("7db0"),a("c740"),a("4160"),a("c975"),a("a15b"),a("a434"),a("a9e3"),a("d3b7"),a("ac1f"),a("25f0"),a("841c"),a("1276"),a("498a"),a("159b"),a("5530")),n=a("b85c"),l=a("53ca"),s=a("ca00"),c=a("1610"),u={components:{csUpload:function(){return a.e("chunk-24515411").then(a.bind(null,"8422"))},csStorage:function(){return a.e("chunk-564cb293").then(a.bind(null,"8704"))}},props:{loading:{default:!1},typeData:{default:function(){}},tableData:{default:function(){return[]}},selectId:{default:null}},data:function(){var t=this,e=function(e,a,o){if(t.form.attr_input_type>0&&!a)return o(new Error("可选值不能为空"));o()};return{currentTableData:[],multipleSelection:[],auth:{add:!1,add_son:!1,set:!1,del:!1,important:!1,not_important:!1,sort:!1,search:!1},indexMap:{0:"不检索",1:"关键词",2:"范围"},inputMap:{0:"手工填写",1:"单选",2:"多选"},importantMap:{0:"设为核心",1:"取消核心"},dialogLoading:!1,dialogFormVisible:!1,dialogStatus:"",textMap:{update:"编辑主属性",create:"新增主属性",sonUpdate:"编辑子属性",sonCreate:"新增子属性"},form:{attr_name:void 0,description:void 0,icon:void 0,goods_type_id:void 0,sort:void 0,parent_id:void 0,attr_index:void 0,attr_input_type:void 0,attr_values:void 0,is_important:void 0},rules:{attr_name:[{required:!0,message:"名称不能为空",trigger:"blur"},{max:60,message:"长度不能大于 60 个字符",trigger:"blur"}],description:[{max:255,message:"长度不能大于 255 个字符",trigger:"blur"}],icon:[{max:512,message:"长度不能大于 512 个字符",trigger:"blur"}],goods_type_id:[{required:!0,message:"至少选择一项",trigger:"change"}],sort:[{type:"number",message:"必须为数字值",trigger:"blur"}],attr_input_type:[{required:!0,message:"至少选择一项",trigger:"change"}],attr_values:[{validator:e,trigger:"blur"}]}}},watch:{tableData:{handler:function(t){this.currentTableData=t},immediate:!0}},filters:{getAttrValue:function(t){return t&&"object"===Object(l["a"])(t)?t.join(","):t},getPreviewUrl:function(t){return t?s["a"].getImageCodeUrl(t,"goods_attribute"):""}},mounted:function(){this._validationAuth()},methods:{_validationAuth:function(){this.auth.add=this.$permission("/goods/setting/attribute/add"),this.auth.add_son=this.$permission("/goods/setting/attribute/add_son"),this.auth.set=this.$permission("/goods/setting/attribute/set"),this.auth.del=this.$permission("/goods/setting/attribute/del"),this.auth.important=this.$permission("/goods/setting/attribute/important"),this.auth.sort=this.$permission("/goods/setting/attribute/sort"),this.auth.search=this.$permission("/goods/setting/attribute/search")},_getIdList:function(t){null===t&&(t=this.multipleSelection);var e=[];return Array.isArray(t)?t.forEach((function(t){e.push(t.goods_attribute_id)})):e.push(this.currentTableData[t].goods_attribute_id),e},handleCommand:function(t){switch(t){case"storage":this.$refs.storage.handleStorageDlg([0,2]);break;case"upload":this.$refs.upload.handleUploadDlg();break}},_getUploadFileList:function(t){if(t.length){var e=t[0].response;e&&200===e.status&&0===e.data[0].type&&(this.form.icon=e.data[0].url)}},_getStorageFileList:function(t){if(t.length){var e,a=Object(n["a"])(t);try{for(a.s();!(e=a.n()).done;){var o=e.value;if(0===o.type){this.form.icon=o.url;break}}}catch(r){a.e(r)}finally{a.f()}}},sortChange:function(t){var e=t.column,a=t.prop,o=t.order,r={order_type:void 0,order_field:void 0};e&&o&&(r.order_type="ascending"===o?"asc":"desc",r.order_field=a),this.$emit("sort",r)},handleSelectionChange:function(t){this.multipleSelection=t},handleIndex:function(t){var e=this,a=this._getIdList(null);0!==a.length?this.$confirm("确定要执行该操作吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",closeOnClickModal:!1}).then((function(){Object(c["j"])(a,t).then((function(){e.multipleSelection.forEach((function(e){e.parent_id&&(e.attr_index=t)})),e.$refs.multipleTable.clearSelection(),e.$message.success("操作成功")}))})).catch((function(){})):this.$message.error("请选择要操作的数据")},handleDelete:function(t){var e=this,a=t?[t]:this._getIdList(t);0!==a.length?this.$confirm("确定要执行该操作吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",closeOnClickModal:!1}).then((function(){Object(c["c"])(a).then((function(){for(var t=e.currentTableData,o=t.length-1;o>=0;o--)if(-1===a.indexOf(t[o].goods_attribute_id)){var r=t[o].get_attribute;if(r.length>0)for(var i=r.length-1;i>=0;i--)-1!==a.indexOf(r[i].goods_attribute_id)&&r.splice(i,1)}else t.splice(o,1);t.length<=0&&e.$emit("refresh",!0),e.$refs.multipleTable.clearSelection(),e.$message.success("操作成功")}))})).catch((function(){})):this.$message.error("请选择要操作的数据")},handleImportant:function(t){var e=this,a=t.is_important?0:1;Object(c["h"])([t.goods_attribute_id],a).then((function(){t.is_important=a,e.$message.success("操作成功")}))},handleSort:function(t){Object(c["k"])(t.goods_attribute_id,t.sort)},handleCreate:function(t){var e=this,a=function(t){return t?t.toString():null};this.form={attr_name:"",description:"",icon:"",goods_type_id:t?t.goods_type_id:a(this.selectId),sort:50,parent_id:t?t.goods_attribute_id:0,attr_index:"1",attr_input_type:"1",attr_values:"",is_important:1},this.$nextTick((function(){e.$refs.form&&e.$refs.form.clearValidate(),e.dialogStatus=t?"sonCreate":"create",e.dialogLoading=!1,e.dialogFormVisible=!0}))},create:function(){var t=this;this.$refs.form.validate((function(e){if(e){t.dialogLoading=!0;var a=t.currentTableData;if("create"===t.dialogStatus)Object(c["a"])(t.form).then((function(e){a.unshift(Object(i["a"])(Object(i["a"])({},e.data),{},{get_attribute:[]})),t.dialogFormVisible=!1,t.$message.success("操作成功")})).catch((function(){t.dialogLoading=!1}));else{var o=[];t.form.attr_values&&(o=t.form.attr_input_type>0?t.form.attr_values.trim().split("\n"):[t.form.attr_values]),Object(c["b"])(Object(i["a"])(Object(i["a"])({},t.form),{},{attr_values:o})).then((function(e){var o=a.find((function(t){return t.goods_attribute_id===e.data.parent_id}));o.get_attribute.push(Object(i["a"])({},e.data)),t.dialogFormVisible=!1,t.$message.success("操作成功")})).catch((function(){t.dialogLoading=!1}))}}}))},handleUpdate:function(t){var e=this;t.parent_id?this.form=Object(i["a"])(Object(i["a"])({},t),{},{attr_index:t.attr_index.toString(),attr_input_type:t.attr_input_type.toString(),attr_values:t.attr_values.join("\n")}):this.form=Object(i["a"])(Object(i["a"])({},t),{},{goods_type_id:t.goods_type_id.toString()}),this.$nextTick((function(){e.$refs.form&&e.$refs.form.clearValidate(),e.currentData=t,e.dialogStatus=t.parent_id?"sonUpdate":"update",e.dialogLoading=!1,e.dialogFormVisible=!0}))},update:function(){var t=this;this.$refs.form.validate((function(e){if(e)if(t.dialogLoading=!0,"update"===t.dialogStatus)Object(c["g"])(t.form).then((function(e){var a=t.currentTableData.findIndex((function(e){return e.goods_attribute_id===t.currentData.goods_attribute_id}));t.selectId&&e.data.goods_type_id!==Number(t.selectId)?(t.currentTableData.splice(a,1),t.currentTableData.length<=0&&t.$emit("refresh",!0)):t.$set(t.currentTableData,a,Object(i["a"])(Object(i["a"])({},t.currentData),e.data)),t.dialogFormVisible=!1,t.$refs.multipleTable.clearSelection(),t.$message.success("操作成功")})).catch((function(){t.dialogLoading=!1}));else{var a=[];t.form.attr_values&&(a=t.form.attr_input_type>0?t.form.attr_values.trim().split("\n"):[t.form.attr_values]),Object(c["i"])(Object(i["a"])(Object(i["a"])({},t.form),{},{attr_values:a})).then((function(e){var a=t.currentTableData.findIndex((function(e){return e.goods_attribute_id===t.currentData.parent_id})),o=t.currentTableData[a].get_attribute,r=o.findIndex((function(e){return e.goods_attribute_id===t.currentData.goods_attribute_id}));t.$set(o,r,Object(i["a"])(Object(i["a"])({},t.currentData),e.data)),t.dialogFormVisible=!1,t.$refs.multipleTable.clearSelection(),t.$message.success("操作成功")})).catch((function(){t.dialogLoading=!1}))}}))},changeAttrValue:function(t){"0"===t&&(this.form.attr_index="0"),this.$refs.form.validateField("attr_values")}}},d=u,p=(a("9aeb"),a("2877")),f=Object(p["a"])(d,o,r,!1,null,"7f9080fa",null);e["default"]=f.exports},7623:function(t,e,a){},"9aeb":function(t,e,a){"use strict";a("7623")},c8d2:function(t,e,a){var o=a("d039"),r=a("5899"),i="​᠎";t.exports=function(t){return o((function(){return!!r[t]()||i[t]()!=i||r[t].name!==t}))}}}]);