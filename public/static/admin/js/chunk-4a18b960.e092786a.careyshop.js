(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4a18b960"],{"2af7":function(e,t,a){"use strict";function o(e,t,a,o){return new(a||(a=Promise))((function(n,r){function i(e){try{s(o.next(e))}catch(e){r(e)}}function l(e){try{s(o.throw(e))}catch(e){r(e)}}function s(e){e.done?n(e.value):new a((function(t){t(e.value)})).then(i,l)}s((o=o.apply(e,t||[])).next())}))}function n(e,t){var a,o,n,r,i={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return r={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function l(r){return function(l){return function(r){if(a)throw new TypeError("Generator is already executing.");for(;i;)try{if(a=1,o&&(n=2&r[0]?o.return:r[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,r[1])).done)return n;switch(o=0,n&&(r=[2&r[0],n.value]),r[0]){case 0:case 1:n=r;break;case 4:return i.label++,{value:r[1],done:!1};case 5:i.label++,o=r[1],r=[0];continue;case 7:r=i.ops.pop(),i.trys.pop();continue;default:if(!(n=(n=i.trys).length>0&&n[n.length-1])&&(6===r[0]||2===r[0])){i=0;continue}if(3===r[0]&&(!n||r[1]>n[0]&&r[1]<n[3])){i.label=r[1];break}if(6===r[0]&&i.label<n[1]){i.label=n[1],n=r;break}if(n&&i.label<n[2]){i.label=n[2],i.ops.push(r);break}n[2]&&i.ops.pop(),i.trys.pop();continue}r=t.call(e,i)}catch(e){r=[6,e],o=0}finally{a=n=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,l])}}}a.d(t,"a",(function(){return m}));var r=["text/plain","text/html"],i=function(){(console.warn||console.log).call(arguments)}.bind(console,"[clipboard-polyfill]"),l=!0,s=function(){function e(){this.m={}}return e.prototype.setData=function(e,t){l&&-1===r.indexOf(e)&&i("Unknown data type: "+e,"Call clipboard.suppressWarnings() to suppress this warning."),this.m[e]=t},e.prototype.getData=function(e){return this.m[e]},e.prototype.forEach=function(e){for(var t in this.m)e(this.m[t],t)},e}(),c=function(e){},d=!0,u=function(){(console.warn||console.log).apply(console,arguments)}.bind("[clipboard-polyfill]"),f="text/plain";function p(e){return o(this,void 0,void 0,(function(){var t;return n(this,(function(a){if(d&&!e.getData(f)&&u("clipboard.write() was called without a `text/plain` data type. On some platforms, this may result in an empty clipboard. Call clipboard.suppressWarnings() to suppress this warning."),y()){if(function(e){var t=e.getData(f);if(void 0!==t)return window.clipboardData.setData("Text",t);throw new Error("No `text/plain` value was specified.")}(e))return[2];throw new Error("Copying failed, possibly because the user rejected it.")}if(h(e))return c("regular execCopy worked"),[2];if(navigator.userAgent.indexOf("Edge")>-1)return c('UA "Edge" => assuming success'),[2];if(b(document.body,e))return c("copyUsingTempSelection worked"),[2];if(function(e){var t=document.createElement("div");t.setAttribute("style","-webkit-user-select: text !important"),t.textContent="temporary element",document.body.appendChild(t);var a=b(t,e);return document.body.removeChild(t),a}(e))return c("copyUsingTempElem worked"),[2];if(void 0!==(t=e.getData(f))&&function(e){c("copyTextUsingDOM");var t=document.createElement("div");t.setAttribute("style","-webkit-user-select: text !important");var a=t;t.attachShadow&&(c("Using shadow DOM."),a=t.attachShadow({mode:"open"}));var o=document.createElement("span");o.innerText=e,a.appendChild(o),document.body.appendChild(t),v(o);var n=document.execCommand("copy");return w(),document.body.removeChild(t),n}(t))return c("copyTextUsingDOM worked"),[2];throw new Error("Copy command failed.")}))}))}function m(e){return o(this,void 0,void 0,(function(){return n(this,(function(t){return navigator.clipboard&&navigator.clipboard.writeText?(c("Using `navigator.clipboard.writeText()`."),[2,navigator.clipboard.writeText(e)]):[2,p(x(e))]}))}))}var g=function(){this.success=!1};function h(e){var t=new g,a=function(e,t,a){c("listener called"),e.success=!0,t.forEach((function(t,o){var n=a.clipboardData;n.setData(o,t),o===f&&n.getData(o)!==t&&(c("setting text/plain failed"),e.success=!1)})),a.preventDefault()}.bind(this,t,e);document.addEventListener("copy",a);try{document.execCommand("copy")}finally{document.removeEventListener("copy",a)}return t.success}function b(e,t){v(e);var a=h(t);return w(),a}function v(e){var t=document.getSelection();if(t){var a=document.createRange();a.selectNodeContents(e),t.removeAllRanges(),t.addRange(a)}}function w(){var e=document.getSelection();e&&e.removeAllRanges()}function x(e){var t=new s;return t.setData(f,e),t}function y(){return"undefined"==typeof ClipboardEvent&&void 0!==window.clipboardData&&void 0!==window.clipboardData.setData}},5138:function(e,t,a){"use strict";var o=a("9520"),n=a.n(o);n.a},"85ae":function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"cs-p"},[a("el-form",{attrs:{inline:!0,size:"small"}},[e.auth.add?a("el-form-item",[a("el-button",{attrs:{icon:"el-icon-plus",disabled:e.loading},on:{click:e.handleCreate}},[e._v("新增二维码")])],1):e._e(),e.auth.del?a("el-form-item",[a("el-button",{attrs:{icon:"el-icon-delete",disabled:e.loading},on:{click:function(t){return e.handleDelete(null)}}},[e._v("删除")])],1):e._e(),a("cs-help",{staticStyle:{"padding-bottom":"19px"},attrs:{router:e.$route.path}})],1),a("el-table",{attrs:{data:e.currentTableData,"highlight-current-row":!0},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{align:"center",type:"selection",width:"55"}}),a("el-table-column",{attrs:{label:"名称",prop:"name","min-width":"180"}}),a("el-table-column",{attrs:{label:"内容",prop:"text","min-width":"220","show-overflow-tooltip":!0}}),a("el-table-column",{attrs:{label:"Logo",prop:"logo",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.logo?a("el-popover",{attrs:{width:"150",placement:"top",trigger:"hover"}},[a("div",{staticClass:"popover-image"},[a("el-image",{attrs:{src:t.row.logo,fit:"fill"},on:{click:function(a){return a.stopPropagation(),e.$preview(t.row.logo)}}})],1),a("i",{staticClass:"el-icon-picture",attrs:{slot:"reference"},slot:"reference"})]):e._e()]}}])}),a("el-table-column",{attrs:{label:"尺寸",prop:"size"}}),a("el-table-column",{attrs:{label:"后缀",prop:"suffix"}}),a("el-table-column",{attrs:{label:"操作",align:"center","min-width":"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.auth.view?a("el-button",{attrs:{size:"small",type:"text"},on:{click:function(a){return e.handleView(t.$index)}}},[e._v("详细")]):e._e(),e.auth.set?a("el-button",{attrs:{size:"small",type:"text"},on:{click:function(a){return e.handleUpdate(t.$index)}}},[e._v("编辑")]):e._e(),e.auth.del?a("el-button",{attrs:{size:"small",type:"text"},on:{click:function(a){return e.handleDelete(t.$index)}}},[e._v("删除")]):e._e()]}}])})],1),a("el-dialog",{attrs:{title:e.textMap[e.dialogStatus],visible:e.dialogFormVisible,"append-to-body":!0,"close-on-click-modal":!1,width:"600px"},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"名称",prop:"name"}},[a("el-input",{attrs:{placeholder:"请输入二维码名称",clearable:!0},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),a("el-form-item",{attrs:{label:"内容",prop:"text"}},[a("el-input",{attrs:{placeholder:"请输入二维码内容",type:"textarea",rows:3},model:{value:e.form.text,callback:function(t){e.$set(e.form,"text",t)},expression:"form.text"}})],1),a("el-form-item",{attrs:{label:"Logo",prop:"logo"}},[a("el-input",{attrs:{placeholder:"可输入二维码Logo链接",clearable:!0},model:{value:e.form.logo,callback:function(t){e.$set(e.form,"logo",t)},expression:"form.logo"}},[a("el-dropdown",{attrs:{slot:"append","show-timeout":50},on:{command:e.handleCommand},slot:"append"},[a("el-button",{attrs:{icon:"el-icon-upload"}}),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{attrs:{command:"storage",icon:"el-icon-finished"}},[e._v("资源选择")]),a("el-dropdown-item",{attrs:{command:"upload",icon:"el-icon-upload2"}},[e._v("上传资源")])],1)],1)],1)],1),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"尺寸",prop:"size"}},[a("el-input-number",{attrs:{"controls-position":"right",min:50,max:65535,step:10},model:{value:e.form.size,callback:function(t){e.$set(e.form,"size",t)},expression:"form.size"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"后缀",prop:"suffix"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.form.suffix,callback:function(t){e.$set(e.form,"suffix",t)},expression:"form.suffix"}},[a("el-option",{attrs:{label:"png",value:"png"}}),a("el-option",{attrs:{label:"jpg",value:"jpg"}}),a("el-option",{attrs:{label:"gif",value:"gif"}})],1)],1)],1)],1)],1),a("el-divider",[e._v("效果预览")]),e.form.text?a("div",{staticClass:"cs-tc"},[e.qrcodeImage?a("el-image",{attrs:{fit:"fill",src:e.qrcodeImage}}):e._e()],1):e._e(),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取消")]),"create"===e.dialogStatus?a("el-button",{attrs:{type:"primary",loading:e.dialogLoading,size:"small"},on:{click:e.create}},[e._v("确定")]):a("el-button",{attrs:{type:"primary",loading:e.dialogLoading,size:"small"},on:{click:e.update}},[e._v("修改")])],1),a("cs-storage",{ref:"storage",staticStyle:{display:"none"},attrs:{limit:1},on:{confirm:e._getStorageFileList}}),a("cs-upload",{ref:"upload",staticStyle:{display:"none"},attrs:{type:"slot",accept:"image/*",limit:1,multiple:!1},on:{confirm:e._getUploadFileList}})],1),a("el-dialog",{attrs:{title:"二维码预览",visible:e.dialogQrcodeVisible,"append-to-body":!0,"close-on-click-modal":!1,width:"600px"},on:{"update:visible":function(t){e.dialogQrcodeVisible=t}}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:4}},[a("p",[e._v("效果预览")])]),a("el-col",{attrs:{span:20}},[e.qrcodeData.url?a("el-image",{attrs:{fit:"fill",src:e.qrcodeData.url+"&t="+Math.random()}}):e._e()],1)],1),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:4}},[a("p",[e._v("名称")])]),a("el-col",{attrs:{span:20}},[a("p",[e._v(e._s(e.qrcodeData.name))])])],1),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:4}},[a("p",[e._v("实际内容")])]),a("el-col",{attrs:{span:20}},[a("p",[e._v(e._s(e.qrcodeData.text))])])],1),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:4}},[a("p",[e._v("调用地址")])]),a("el-col",{attrs:{span:20}},[a("p",[e._v(e._s(e.qrcodeData.url))])])],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:e.handleCopy}},[e._v("复制调用地址")]),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){e.dialogQrcodeVisible=!1}}},[e._v("确定")])],1)],1)],1)},n=[],r=(a("4160"),a("b0c0"),a("d3b7"),a("159b"),a("5530")),i=a("b85c"),l=a("f749"),s=a("60bb"),c=a("2af7"),d=a("ca00"),u={components:{csUpload:function(){return a.e("chunk-17909d0b").then(a.bind(null,"8422"))},csStorage:function(){return a.e("chunk-37826a7f").then(a.bind(null,"8704"))}},props:{loading:{default:!1},tableData:{default:function(){return[]}}},data:function(){return{qrcodeUrl:"",qrcodeImage:"",currentTableData:[],multipleSelection:[],auth:{add:!1,set:!1,del:!1,view:!1},dialogLoading:!1,dialogFormVisible:!1,dialogStatus:"",dialogQrcodeVisible:!1,qrcodeData:{name:"",text:"",url:""},textMap:{update:"编辑二维码",create:"新增二维码"},form:{name:void 0,text:void 0,size:void 0,logo:void 0},rules:{name:[{required:!0,message:"名称不能为空",trigger:"blur"},{max:50,message:"长度不能大于 50 个字符",trigger:"blur"}],text:[{required:!0,message:"内容不能为空",trigger:"blur"},{max:255,message:"内容不能大于 255 个字符",trigger:"blur"}],logo:[{max:512,message:"长度不能大于 512 个字符",trigger:"blur"}],size:[{type:"number",message:"必须为数字值",trigger:"blur"}],suffix:[{required:!0,message:"至少选择一项",trigger:"change"}]}}},computed:{changeQrcode:function(){var e=this.form,t=e.text,a=e.size,o=e.logo,n=e.suffix;return{text:t,size:a,logo:o,suffix:n}}},watch:{tableData:{handler:function(e){this.currentTableData=e},immediate:!0},changeQrcode:{handler:function(){var e=this;this.$nextTick((function(){e._getQrcodeImage()}))}},dialogQrcodeVisible:{handler:function(e){!1===e&&(this.qrcodeData.url="")}}},mounted:function(){var e=this;this._validationAuth(),Object(l["c"])().then((function(t){e.qrcodeUrl=t.data.call_url}))},methods:{_validationAuth:function(){this.auth.add=this.$permission("/system/aided/qrcode/add"),this.auth.set=this.$permission("/system/aided/qrcode/set"),this.auth.del=this.$permission("/system/aided/qrcode/del"),this.auth.view=this.$permission("/system/aided/qrcode/view")},_getIdList:function(e){null===e&&(e=this.multipleSelection);var t=[];return Array.isArray(e)?e.forEach((function(e){t.push(e.qrcode_id)})):t.push(this.currentTableData[e].qrcode_id),t},handleCommand:function(e){switch(e){case"storage":this.$refs.storage.handleStorageDlg([0,2]);break;case"upload":this.$refs.upload.handleUploadDlg();break}},_getQrcodeImage:Object(s["debounce"])((function(){if(this.form.text){var e=this.form,t=e.text,a=e.size,o=e.logo,n=e.suffix;this.qrcodeImage=d["a"].getQrcodeUrl("",{text:t,size:a,logo:o,suffix:n})}}),500),_getUploadFileList:function(e){if(e.length){var t=e[0].response;t&&200===t.status&&0===t.data[0].type&&(this.form.logo=d["a"].checkUrl(t.data[0].url))}},_getStorageFileList:function(e){if(e.length){var t,a=Object(i["a"])(e);try{for(a.s();!(t=a.n()).done;){var o=t.value;if(0===o.type){this.form.logo=d["a"].checkUrl(o.url);break}}}catch(n){a.e(n)}finally{a.f()}}},handleSelectionChange:function(e){this.multipleSelection=e},handleCreate:function(){var e=this;this.qrcodeImage="",this.form={name:"",text:"",size:75,logo:"",suffix:"png"},this.$nextTick((function(){e.$refs.form&&e.$refs.form.clearValidate(),e.dialogStatus="create",e.dialogLoading=!1,e.dialogFormVisible=!0}))},create:function(){var e=this;this.$refs.form.validate((function(t){t&&(e.dialogLoading=!0,Object(l["a"])(Object(r["a"])({},e.form)).then((function(t){e.currentTableData.unshift(t.data),e.dialogFormVisible=!1,e.$message.success("操作成功")})).catch((function(){e.dialogLoading=!1})))}))},handleDelete:function(e){var t=this,a=this._getIdList(e);0!==a.length?this.$confirm("确定要执行该操作吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",closeOnClickModal:!1}).then((function(){Object(l["b"])(a).then((function(){d["a"].deleteDataList(t.currentTableData,a,"qrcode_id"),t.currentTableData.length<=0&&t.$emit("refresh",!0),t.$message.success("操作成功")}))})).catch((function(){})):this.$message.error("请选择要操作的数据")},handleUpdate:function(e){var t=this;this.qrcodeImage="",this.currentIndex=e,this.form=Object(r["a"])({},this.currentTableData[e]),this.$nextTick((function(){t.$refs.form&&t.$refs.form.clearValidate(),t.dialogStatus="update",t.dialogLoading=!1,t.dialogFormVisible=!0}))},update:function(){var e=this;this.$refs.form.validate((function(t){t&&(e.dialogLoading=!0,Object(l["e"])(Object(r["a"])({},e.form)).then((function(t){e.$set(e.currentTableData,e.currentIndex,Object(r["a"])(Object(r["a"])({},e.currentTableData[e.currentIndex]),t.data)),e.dialogFormVisible=!1,e.$message.success("操作成功")})).catch((function(){e.dialogLoading=!1})))}))},handleView:function(e){var t=this.currentTableData[e];this.qrcodeData={name:t.name,text:t.text,url:this.qrcodeUrl+"?qrcode_id=".concat(t.qrcode_id)},this.dialogQrcodeVisible=!0},handleCopy:function(){var e=this;c["a"](this.qrcodeData.url).then((function(){e.$message.success("已复制调用地址到剪贴板")})).catch((function(t){e.$message.error(t)}))}}},f=u,p=(a("5138"),a("2877")),m=Object(p["a"])(f,o,n,!1,null,"559a7fe7",null);t["default"]=m.exports},9520:function(e,t,a){}}]);